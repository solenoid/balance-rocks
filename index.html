<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <title>Balance Rocks</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      body {
        font-family: HelveticaNeue, Helvetica Neue, Helvetica, Arial, sans-serif;
        margin: 0;
        padding: 5px;
        background: #ddd;
      }
      h1 {
        margin: 0;
      }
      img {
        vertical-align: bottom;
      }
    </style>
  </head>
  <body>
    <h1>Balance Rocks</h1>
    <div id="app">
      <template v-for="photo in minPhotos">
        <a :href="photo.url" target="photo" :key="photo.url">
          <img :src="photo.src" :alt="photo.alt" />
        </a>
      </template>
    </div>
    <script type="module">
      import Vue from "https://cdn.jsdelivr.net/npm/vue@2.6.8/dist/vue.esm.browser.js";
      import { CANNED_RESPONSE } from "./canned.js";

      let vm = new Vue({
        el: "#app",
        data: {
          photos: [],
        },
        computed: {
          minPhotos: function() {
            return this.photos.map(d => {
              // TODO stop assuming url structure that seems to happen in practice
              const urlParts = d.url.split("/");
              const nameParts = urlParts[urlParts.length - 2].split("-");
              // remove the number part of the name
              nameParts.pop();
              return {
                url: d.url,
                src: d.src.tiny,
                alt: nameParts.join(" ") + " by " + d.photographer,
              };
            });
          },
        },
        errorCaptured: function() {
          console.log("errorCaptured");
        },
      });

      const LIVE_API = false;
      if (LIVE_API) {
        // TODO consider reading and respecting rate limiting response headers
        fetch("https://api.pexels.com/v1/search?query=balance+rocks&per_page=12", {
          headers: { Authorization: "TBD how to do this safely or if it even matters" },
        })
          .then(r => r.json())
          .then(r => {
            vm.photos = r.photos;
          })
          .catch(e => {
            console.error(e);
          });
      } else {
        vm.photos = CANNED_RESPONSE.photos;
      }
    </script>
  </body>
</html>
